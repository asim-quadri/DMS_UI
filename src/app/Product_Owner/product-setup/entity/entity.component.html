<div class="main-container">
  <app-header-menus [active]="active"></app-header-menus>
  <div
    class="home-content user-table product-setup"
    *ngIf="common.isLoaded; else loader"
  >
    <div class="row">
      <div class="col-md-6">
        <form action="">
          <div class="row ms-auto">
            <div class="col-4">
              <label for="">Country : aa</label>
              <ng-multiselect-dropdown
                name="Country"
                placeholder="Select Country"
                [settings]="addMapping.countryDD"
                [data]="addMapping.countryDD.data"
                [(ngModel)]="addMapping.countryDD.selectedItems"
                [ngClass]="{
                  'multiselect-dropdown-error':
                    addMapping.isSubmit &&
                    addMapping.countryDD.selectedItems.length === 0
                }"
              >
              </ng-multiselect-dropdown>
            </div>
            <div class="col-4">
              <label for="">Entity Type :</label>
              <ng-multiselect-dropdown
                name="Entity"
                [placeholder]="'Entity Type'"
                [settings]="addMapping.entityDD"
                [data]="addMapping.entityDD.data"
                [(ngModel)]="addMapping.entityDD.selectedItems"
                [ngClass]="{
                  'multiselect-dropdown-error':
                    addMapping.isSubmit &&
                    addMapping.entityDD.selectedItems.length === 0
                }"
              >
              </ng-multiselect-dropdown>
            </div>
            <div class="col-1 mt-25">
              <button
                class="btn btn-color btn-block m-10"
                (click)="addEntityMapping()"
                *ngIf="showAddButton"
              >
                <i
                  class="fa fa-spinner fa-spin px-2"
                  *ngIf="!newEntity.isLoaded"
                ></i>
                Add
              </button>
            </div>
          </div>
        </form>
      </div>
      <div class="col-3"></div>
      <div class="col-3 mt-25 pl-70 ms-auto">
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button
            class="btn btn-color btn-block m-10"
            (click)="openPopUp(entityPopUp)"
            *ngIf="showAddNewEntityTypeButton"
          >
            <i class="fa-solid fa-industry"></i> &nbsp; Add New Entity Type
          </button>
        </div>
      </div>
    </div>
    <div class="row mt-20">
      <div class="product-panel">
        <div class="product-panel-header">
          <div class="row">
            <div class="col-md-4">
              <div class="input-group text-center">
                <label for="Country" class="mt-10"
                  >Country: &nbsp; &nbsp;
                </label>
                <input
                  type="search"
                  class="form-control"
                  placeholder="Search by keywords ..."
                  (keyup)="onSearch('country', $event.target)"
                />
                <div class="input-group-prepend">
                  <button class="btn btn-white" type="button">
                    <i class="bi bi-search"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="col-8 text-center">
              <h4>Entity Type</h4>
            </div>
          </div>
        </div>
        <div class="product-panel-body">
          <div class="row">
            <div class="col-4">
              <div class="panel-gray uppercase">
                <button
                  class="btn btn-trash"
                  *ngIf="view.country.data.length > 0 && !view.country.isDelete"
                  (click)="onDeleteClick('country', true)"
                >
                  <i class="fa-solid fa-trash-can"></i>
                </button>

                <button
                  class="btn btn-trash"
                  *ngIf="view.country.data.length > 0 && view.country.isDelete"
                  (click)="onDeleteClick('country', false)"
                >
                  <i class="fa-solid fa-times"></i>
                </button>
                <ul>
                  <li
                    *ngFor="let v of view.country.data"
                    [ngClass]="{
                      'li-active': view.selected === v.countryName,
                      'border border-danger': view.country.isDelete
                    }"
                    (click)="setSelectedCountry(v)"
                    (click)="
                      openDeletePopUp('country', deleteCountry, v.fk_country_id)
                    "
                  >
                    {{ v.countryName }}
                  </li>
                  <li *ngIf="view.country.data.length === 0">No record</li>
                </ul>
                <div class="clearfix"></div>
              </div>
              <button
                class="btn btn-approve mt-20"
                (click)="openPopUp(mappingApprovals, 'xl')" *ngIf="showApprovalButton"
              >
                <i class="bi bi-arrow-down-up"></i> &nbsp; APPROVALS &nbsp;
                <span>{{ approval.count }}</span>
              </button>
            </div>
            <div class="col-8">
              <div class="panel-gray">
                <button
                  class="btn btn-trash"
                  *ngIf="view.entity.data.length > 0 && !view.entity.isDelete"
                  (click)="onDeleteClick('entity', true)"
                >
                  <i class="fa-solid fa-trash-can"></i>
                </button>

                <button
                  class="btn btn-trash"
                  *ngIf="view.entity.data.length > 0 && view.entity.isDelete"
                  (click)="onDeleteClick('entity', false)"
                >
                  <i class="fa-solid fa-times"></i>
                </button>
                <ul>
                  <li
                    *ngFor="let v of view.entity.data"
                    [ngClass]="{
                      'border border-danger': view.entity.isDelete
                    }"
                    (click)="openDeletePopUp('entity', deleteEntity, v)"
                  >
                    {{ v.type }}
                  </li>
                  <li *ngIf="view.entity.data.length === 0">No record</li>
                </ul>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- new entity-->
<ng-template #entityPopUp let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Add New Entity</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <form [formGroup]="newEntity.form" (ngSubmit)="insertEntity()">
      <div class="mb-3 text-center">
        <label for="">Entity Type</label>
        <div class="input-group text-center">
          <input
            type="text"
            class="form-control"
            placeholder="Enter Entity Type"
            name="entityName"
            appAutofocus
            formControlName="name"
          />
        </div>
      </div>

      <div class="mb-3 text-center">
        <label for="">Entity Type Code</label>
        <div class="input-group text-center">
          <input
            type="text"
            class="form-control"
            placeholder="Ex: Pvt Ltd"
            name="entityCode"
            formControlName="code"
          />
        </div>
      </div>

      <div class="mb-3 text-center">
        <button
          class="btn btn-color btn-block"
          [ngClass]="{ notAllow: !this.newEntity.form.valid }"
        >
          &nbsp;
          <i class="fa fa-spinner fa-spin px-2" *ngIf="!newEntity.isLoaded"></i>
          Add Entity Type &nbsp;
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #mappingApprovals let-modal>
  <div class="modal-header">
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <ul ngbNav #nav="ngbNav" class="nav-tabs justify-content-center">
      <li ngbNavItem>
        <a ngbNavLink
          ><i class="bi bi-arrow-down-up"></i> &nbsp; Approvals for Mapping
          &nbsp;
          <span>{{
            approval.mapping.pending + approval.mapping.rejected
          }}</span></a
        >
        <ng-template ngbNavContent>
          <div class="row mt-40">
            <div class="col-md-8">
              <div class="stauts-list">
                <ul>
                  <li class="mt-03 mr-10">
                    <i class="bi bi-arrow-down-up"></i>&nbsp;Approvals
                  </li>
                  <li class="status-circle green-status"></li>
                  <li class="status-text">
                    {{ approval.mapping.approved }} Approved
                  </li>

                  <li class="status-circle oragne-status"></li>
                  <li class="status-text">
                    {{ approval.mapping.pending }} Pending
                  </li>

                  <li class="status-circle red-status"></li>
                  <li class="status-text">
                    {{ approval.mapping.rejected }} Rejected
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-md-4">
              <form action="">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search by keyword  ..."
                  />
                  <div class="input-group-append">
                    <button class="btn btn-search h45" type="submit">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="row">
            <div class="table-responsive modal-table">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col"></th>
                    <th scope="col">S.No</th>
                    <th scope="col">Entity Type</th>
                    <th scope="col">Country</th>
                    <th scope="col">Point of Contact</th>
                    <th scope="col">Status</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let v of approval.mapping.data; index as i">
                    <td scope="row" class="bg-white">
                      <input
                        type="checkbox"
                        [checked]="false"
                        (click)="isApproveAllow($event, v)"
                        [ngClass]="{
                          disabled: !v.isApprovalAllow
                        }"
                      />
                    </td>
                    <td
                      scope="row"
                      [ngClass]="{
                        'status-pending': v.status === 'Pending',
                        'status-reject': v.status === 'Rejected',
                        'status-approved': v.status === 'Approved'
                      }"
                    >
                      {{ i + 1 }}
                    </td>
                    <td scope="row">{{ v.type }}</td>
                    <td scope="row">{{ v.countryName }}</td>
                    <td scope="row">{{ v.approval_name }}</td>
                    <td scope="row" *ngIf="v.status !== 'Rejected'">
                      {{ v.status }}
                    </td>
                    <td
                      scope="row"
                      class="reject"
                      *ngIf="v.status === 'Rejected'"
                    >
                      <span>Approval Rejected</span> <br />
                      by {{ v.approval_name }}
                    </td>
                    <td
                      scope="row"
                      (click)="openPopUp(maping)"
                      (click)="modal.dismiss('mappingApprovals')"
                    >
                      Forward <i class="fa-regular fa-circle-right"></i>
                    </td>
                  </tr>
                  <tr *ngIf="approval.mapping.data.length === 0">
                    <td scope="row" colspan="7">No record</td>
                  </tr>
                </tbody>
              </table>
              <div class="row">
                <div class="col-8"></div>
                <div class="col-4">
                  <button
                    class="btn btn-accept"
                    (click)="mappingStatusUpdate(true)"
                  >
                    <i
                      class="fa fa-spinner fa-spin px-2"
                      *ngIf="!approval.isLoaded"
                    ></i>
                    <i class="bi bi-check2-circle"></i> &nbsp; ACCEPT
                  </button>
                  &nbsp;
                  <button
                    class="btn btn-reject"
                    (click)="mappingStatusUpdate(false)"
                  >
                    <i
                      class="fa fa-spinner fa-spin px-2"
                      *ngIf="!approval.isLoaded"
                    ></i>
                    <i class="bi bi-x-circle"></i> &nbsp;REJECT
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
      <li ngbNavItem>
        <a ngbNavLink
          ><i class="bi bi-arrow-down-up"></i> &nbsp; Approvals for Insertion
          &nbsp;
          <span>{{
            approval.insertion.pending + approval.insertion.rejected
          }}</span></a
        >
        <ng-template ngbNavContent>
          <div class="row mt-40">
            <div class="col-md-8">
              <div class="stauts-list">
                <ul>
                  <li class="mt-03 mr-10">
                    <i class="bi bi-arrow-down-up"></i>&nbsp;Approvals
                  </li>
                  <li class="status-circle green-status"></li>
                  <li class="status-text">
                    {{ approval.insertion.approved }} Approved
                  </li>

                  <li class="status-circle oragne-status"></li>
                  <li class="status-text">
                    {{ approval.insertion.pending }} Pending
                  </li>

                  <li class="status-circle red-status"></li>
                  <li class="status-text">
                    {{ approval.insertion.rejected }} Rejected
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-md-4">
              <form action="">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search by keyword  ..."
                  />
                  <div class="input-group-append">
                    <button class="btn btn-search h45" type="submit">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="row">
            <div class="table-responsive modal-table">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col"></th>
                    <th scope="col">S.No</th>
                    <th scope="col">Entity Type</th>
                    <th scope="col">Code</th>
                    <th scope="col">Point of Contact</th>
                    <th scope="col">Status</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let v of approval.insertion.data; index as i">
                    <td scope="row" class="bg-white">
                      <input
                        type="checkbox"
                        (click)="isApproveAllow($event, v)"
                        [checked]="v.isChecked"
                        [ngClass]="{
                          disabled: !v.isApprovalAllow
                        }"
                      />
                    </td>
                    <td
                      scope="row"
                      [ngClass]="{
                        'status-pending': v.status === 'Pending',
                        'status-reject': v.status === 'Rejected',
                        'status-approved': v.status === 'Approved'
                      }"
                    >
                      {{ i + 1 }}
                    </td>
                    <td scope="row">{{ v.type }}</td>
                    <td scope="row">{{ v.code }}</td>
                    <td scope="row">{{ v.approval_name }}</td>
                    <td scope="row" *ngIf="v.status !== 'Rejected'">
                      {{ v.status }}
                    </td>
                    <td
                      scope="row"
                      class="reject"
                      *ngIf="v.status === 'Rejected'"
                    >
                      <span>Approval Rejected</span> <br />
                      by {{ v.approval_name }}
                    </td>
                    <td scope="row">
                      Forward <i class="fa-regular fa-circle-right"></i>
                    </td>
                  </tr>
                  <tr *ngIf="approval.insertion.data.length === 0">
                    <td scope="row" colspan="7">No record</td>
                  </tr>
                </tbody>
              </table>
              <div class="row">
                <div class="col-8"></div>
                <div class="col-4">
                  <button
                    class="btn btn-accept"
                    (click)="entityStatusUpdate(true)"
                  >
                    <i
                      class="fa fa-spinner fa-spin px-2"
                      *ngIf="!approval.isLoaded"
                    ></i>
                    <i class="bi bi-check2-circle"></i> &nbsp; ACCEPT
                  </button>
                  &nbsp;
                  <button
                    class="btn btn-reject"
                    (click)="entityStatusUpdate(false)"
                  >
                    <i
                      class="fa fa-spinner fa-spin px-2"
                      *ngIf="!approval.isLoaded"
                    ></i>
                    <i class="bi bi-x-circle"></i> &nbsp;REJECT
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </li>
    </ul>
    <div [ngbNavOutlet]="nav"></div>
  </div>
</ng-template>

<!-- Major Industry Approval-->
<ng-template #addMajorIndustry let-modal>
  <div class="modal-header">
    <div class="modal-title">Approvals &nbsp; Add New Major Industry</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <div class="row">
      <div class="col-5">
        <button class="btn btn-status">Approval Pending</button>
      </div>
      <div class="col-6 text-center user-info">
        <ul>
          <li>Point of Contact : <span>Haribabu</span></li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-3"></div>
      <div class="col-6 mt-50">
        <form>
          <div class="mb-3 text-center">
            <label for="">Major Industry</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="Agriculture"
                name="majorindustry"
                ngModel
              />
            </div>
          </div>

          <div class="mb-3 text-center">
            <label for="">Major Industry Code</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="Agr1234"
                name="majorindustrycode"
                ngModel
              />
            </div>
          </div>

          <div class="mb-3 text-center">
            <div class="text-center">
              <button class="btn btn-accept">
                <i class="bi bi-check2-circle"></i> &nbsp; ACCEPT
              </button>
              &nbsp;
              <button class="btn btn-reject">
                <i class="bi bi-x-circle"></i> &nbsp;REJECT
              </button>
              <div class="mt-20">
                <br />
                OR <br />
                <a href="" class="forword">Forward</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-template>

<!-- Minor Industry Approval-->
<ng-template #addentityPopUp let-modal>
  <div class="modal-header">
    <div class="modal-title">Approvals &nbsp; Add New Entity Type</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <div class="row">
      <div class="col-5">
        <button class="btn btn-status">Approval Pending</button>
      </div>
      <div class="col-6 text-center user-info">
        <ul>
          <li>Point of Contact : <span>Haribabu</span></li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-3"></div>
      <div class="col-6 mt-50">
        <form>
          <div class="mb-3 text-center">
            <label for="">Entity Type</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="Pvt Ltd Company"
                name="entitytype"
                ngModel
              />
            </div>
          </div>
          <div class="mb-3 text-center">
            <label for="">Entity Type Code</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="PVT LTD"
                name="entitytypecode"
                ngModel
              />
            </div>
          </div>

          <div class="mb-3 text-center">
            <div class="text-center">
              <button class="btn btn-accept">
                <i class="bi bi-check2-circle"></i> &nbsp; ACCEPT
              </button>
              &nbsp;
              <button class="btn btn-reject">
                <i class="bi bi-x-circle"></i> &nbsp;REJECT
              </button>
              <div class="mt-20">
                <br />
                OR <br />
                <a href="" class="forword">Forward</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #maping let-modal>
  <div class="modal-header">
    <div class="modal-title">Approvals &nbsp; Maping</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <div class="row">
      <div class="col-5">
        <button class="btn btn-status">Approval Pending</button>
      </div>
      <div class="col-6 text-center user-info">
        <ul>
          <li>Point of Contact : <span>Haribabu</span></li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-3"></div>
      <div class="col-6 mt-50">
        <form>
          <div class="mb-3 text-center">
            <label for="">Country</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="India"
                name="country"
                ngModel
              />
            </div>
          </div>
          <div class="mb-3 text-center">
            <label for="">Entity Type</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="Pvt Ltd Company"
                name="entitytype"
                ngModel
              />
            </div>
          </div>
          <div class="mb-3 text-center">
            <label for="">Entity Type Code</label>
            <div class="input-group text-center">
              <input
                type="text"
                class="form-control"
                placeholder="PVT LTD"
                name="entitytypecode"
                ngModel
              />
            </div>
          </div>

          <div class="mb-3 text-center">
            <div class="text-center">
              <button class="btn btn-accept">
                <i class="bi bi-check2-circle"></i> &nbsp; ACCEPT
              </button>
              &nbsp;
              <button class="btn btn-reject">
                <i class="bi bi-x-circle"></i> &nbsp;REJECT
              </button>
              <div class="mt-20">
                <br />
                OR <br />
                <a href="" class="forword">Forward</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #download let-modal>
  <div class="modal-header">
    <div class="modal-title">Download File</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <form>
      <div class="mb-3 text-center">
        <label for="">Country Name</label>
        <div class="input-group text-center">
          <select class="form-select" name="country" ngModel>
            <option value="IN">India</option>
            <option value="IN">India</option>
            <option value="IN">India</option>
          </select>
        </div>
      </div>
      <!--       
        <div class="mb-3 text-center">
          <div class="text-center">
            <button class="btn btn-accept"><i class="bi bi-check2-circle"></i> &nbsp; APPROVE</button> &nbsp; 
               <button class="btn btn-reject"><i class="bi bi-x-circle"></i> &nbsp;REJECT</button>
              <div class="mt-20">
                <br>
               OR <br>
               <a href="">Forward</a>
              </div>
          </div>
        </div> -->
    </form>
  </div>
</ng-template>

<ng-template #loader>
  <div class="center">
    <div class="loader"></div>
  </div>
</ng-template>

<!-- delete country-->
<ng-template #deleteCountry let-modal>
  <div class="modal-header">
    <div class="modal-title">Delete Country</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <div class="alert-message text-center">
      <h4>Are you sure you want to delete this country?</h4>
      <div class="d-grid gap-2 d-md-flex justify-content-center">
        <button
          class="btn btn-color btn-no me-md-2"
          type="button"
          (click)="modal.dismiss('Cross click')"
        >
          No
        </button>
        <button class="btn btn-yes" type="button" (click)="onDeleteCountry()">
          <i
            class="fa fa-spinner fa-spin px-2"
            *ngIf="!view.country.isLoaded"
          ></i>
          Yes
        </button>
      </div>
    </div>
  </div>
</ng-template>

<!-- delete entity-->
<ng-template #deleteEntity let-modal>
  <div class="modal-header">
    <div class="modal-title">Delete Entity</div>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body product-steup-modal">
    <div class="alert-message text-center">
      <h4>Are you sure you want to delete this entity?</h4>
      <div class="d-grid gap-2 d-md-flex justify-content-center">
        <button
          class="btn btn-color btn-no me-md-2"
          type="button"
          (click)="modal.dismiss('Cross click')"
        >
          No
        </button>
        <button class="btn btn-yes" type="button" (click)="onDeleteEntity()">
          <i
            class="fa fa-spinner fa-spin px-2"
            *ngIf="!view.entity.isLoaded"
          ></i>
          Yes
        </button>
      </div>
    </div>
  </div>
</ng-template>
